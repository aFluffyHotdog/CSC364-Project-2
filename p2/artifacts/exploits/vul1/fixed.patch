--- login.php	2025-11-21 14:50:23
+++ artifacts/exploits/vul1/login_fixed.php	2025-11-21 14:47:22
@@ -1,4 +1,20 @@
-<?php require 'utils.php'; require 'db.php'; $error=null; if($_SERVER['REQUEST_METHOD']==='POST'){ $db=get_db(); $sql="SELECT * FROM users WHERE username = '{$_POST['username']}' AND password = '{$_POST['password']}' LIMIT 1;"; $row=$db->query($sql)->fetch(PDO::FETCH_ASSOC); if($row){ $_SESSION['user']=$row; header('Location:index.php'); exit; } else { $error='Invalid credentials'; }} site_header('Login'); ?>
+<?php require 'utils.php';
+require 'db.php';
+$error = null;
+if ($_SERVER['REQUEST_METHOD'] === 'POST') {
+  $db = get_db();
+  $stmt = $db->prepare('SELECT * FROM users WHERE username = :username AND password = :password LIMIT 1;');
+  $stmt->execute([ 'username' => $_POST['username'], 'password' => $_POST['password']]);
+  $row = $stmt->fetch(PDO::FETCH_ASSOC);
+  if ($row) {
+    $_SESSION['user'] = $row;
+    header('Location:index.php');
+    exit;
+  } else {
+    $error = 'Invalid credentials';
+  }
+}
+site_header('Login'); ?>
 
 <section class="page-header">
   <h1 class="page-title">Welcome back</h1>
@@ -10,7 +26,7 @@
     <h2>Login</h2>
     <span class="pill">Module 05</span>
   </div>
-  <?php if($error) echo "<div class='alert'>$error</div>"; ?>
+  <?php if ($error) echo "<div class='alert'>$error</div>"; ?>
   <form method="POST" class="form-stack">
     <label class="input-group">
       <span>Username</span>
@@ -27,4 +43,4 @@
   </form>
 </section>
 
-<?php site_footer(); ?>
+<?php site_footer(); ?>
\ No newline at end of file
